{% extends 'exams/index.html' %}

{% block content %}
{% load exams_tag %}
    <h5>Questionaire:  <span class="font-italic ">{{ type }}</span></h5>
    <span class="load-message text-info"></span>
    {% if questions %}
        <form class="form" method="post">
            {% csrf_token  %}
            <div class="alert alert-info alert-dismissible fade show" role="alert">
                <strong>Good Luck!</strong> Please answer the questions carefully. Choose the correct answer. Review answers before sending
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            {% for question in questions %}
                <p class = "text-primary">{{ question.question_text }}</p>
                <div class="form-group">
                    {% for answer in question.answers.all %}  
                        <label for="{{answer.id}}">
                            <input type="radio" id="{{answer.id}}" name="{{question.id}}" 
                           data-answer="{{answer.id}}" 
                           {% if request.user|is_answer:answer.id %}
                            checked
                            {% endif %}
                           data-href="{% url 'exams:answer-question' user.id %}"></label>
                        {{answer.answer_text}}
                        <br>
                    {% endfor %}
                    <span class="text-success"></span>
                </div>
                
                <hr/>
            {% endfor %}
            <div class="btn-group">
                <a class="btn btn secondary" next-path="{{request.get_full_path}}" href="{% url 'exams:reset_quiz' type %}?next={{request.get_full_path}}">Reset Quiz</a>
                <button class="btn btn-primary" data-quiz-category="{{type}}" data-href="">Save Quiz</button>
            </div>
        
    </form>
    
{% else %}
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <strong>No Questions!</strong> Please check with your teacher for this inconvenience.
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
        </button>
    </div>
{% endif %}
<script type="text/javascript">
        var message='';
        $(document).ajaxStart(function(){
            $(".load-message").text('Sending...').fadeIn(2000);
        })
        $(document).ajaxComplete(function(){
            $(".load-message").text(message).fadeOut(1000);
        })
        $(function(){
            var radioObj=$("input[type='radio']");
            radioObj.change(function(){
                question_id=$(this).attr('name')
                answer_id=$(this).attr('data-answer')
                $.ajax({
                    url: $(this).attr('data-href'),
                    data: {
                        answer_id:answer_id,
                        question_id:question_id,
                    },
                    success: function(data){
                            message=data.message
                        },
                    error: function(data){
                            message=data.message  
                        },
                })
                
                console.log(message)
            })
        })
</script>
{% endblock %}
